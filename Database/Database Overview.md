# Database Overview

The database is structured into 2 versions \- **Production** and **Development**

**1\. Production \= Zervio Live**  
Zervio Live has [production-grade data](https://www.precisely.com/blog/data-quality/5-characteristics-of-data-quality), which is Accurate, Complete, Reliable, Relevant and Timely

**2\. Development \= Zervio Dev**  
Zervio Dev has some production data stored but is mostly comprised of dummy data (test data) and dirty data

These two versions of the databases have multiple databases linked together using external IDs — generated by uuid() — to create relationships across tables.

**Most commonly used Databases**

The two most common databases I have accessed and run queries on are:

**1\. PropTech**  
Primarily used for storing any data related to Zervio ECO

**2\. Organization**  
Stores the information of the companies using the product.

## Organization \- Database Overview

The `organization` database holds vital information related to the companies that are using the Zervio system.

The tables within this database contain company-specific details, such as organizational structure, configuration, and related data. Here are breakdowns of some of the tables:

### Organization Table

This table stores the core information about each company using Zervio ECO, identified by their `external_id` and other important attributes such as the name and SaaS_Operator_ID.

When refrenced in other table or databses the `externtal_id` is used a foreign key often named `tentant_id`

### Evidence Config

This table stores information and documentation related to a install workflow, such as various forms, images and permits needed during a install

Below is a SQL query to retrieve evidence configuration data for a specific company, this evidence consists of different types such as `Forms, Images` and `Legal Documents.` Below is a SQL statement to retrieve evidence config data of a specific company:

```sql
SELECT ec.id, ec.name, c.id, c.name, o.name AS category_org, oc.name AS config_org
FROM proptech.evidence_category ec
JOIN proptech.evidence_config c ON ec.id = c.evidence_category_id
JOIN organization.organization o ON ec.tenant_id = o.external_id
JOIN organization.organization oc ON c.tenant_id = oc.external_id
WHERE oc.name = 'HDM Energies'
ORDER BY ec.id, ec.name;

```

### Property Table

The property tables contains all the properties related to a specific organization. Below is a sql statement to retrieve all properties for a specific company:

```sql
SELECT p.formatted_address, o.name
FROM proptech.property p, organization.organization o
WHERE o.name = "CRG Direct";
```

## PropTech \- Database Overview

Primarily used for storing any data related to Zervio ECO

This database is mostly updated with insert statements such as the below

**Activities Tables** \- Activities are different types of work done during a project lifecycle, below is an example of inserting a new activity type

```sql
INSERT INTO proptech.activity_type
( external_id, tenant_id, saas_operator_id, is_default, name, description, tag, allow_job, allow_opportunity)
VALUES( uuid(), 'e7cbb9db-b086-11ee-ba36-42010a400002', 'e7cbb9db-b086-11ee-ba36-42010a400002', 1, 'ASHP Site Survey', 'ASHP Site Survey', 'ASHP_SITE_SURVEY', 1, 1);
```

Each activity type added also needs to be added to the **activity_config** table, id from activity_type is used to link them using **activity_type_id**

```sql
INSERT INTO proptech.activity_type_config
(external_id, activity_type_id, job_type_id, project_id)
VALUES(uuid(), 9, 17, NULL);
```

A service is also needed , this allows installers, and other crew to be assigned to an activity

```sql
INSERT INTO proptech.activity_type_service
(external_id, activity_type_id, service_id, is_mandatory, estimated_duration, qty)
VALUES(uuid(), 4, '341824f0-98c1-11ee-849b-42010a9a000f', 1, 180, 1);

```

Here is how to search activities for a specific property using the address field

```sql
select a.* from proptech.activity a
join proptech.engagement e  on e.id = a.engagement_id
join proptech.property p on p.id = e.property_id
where p.formatted_address like '%Costar%'
```
